---
import { getCollection } from 'astro:content'
import Layout from '../components/Layout.astro'

export async function getStaticPaths() {
  const blogDocs = await getCollection('blog')
  const pageDocs = await getCollection('page')
  const allDocs = [...blogDocs, ...pageDocs]

  return allDocs.map((entry) => ({
    // entry.id から 'page/' などのディレクトリ名を削って slug を作成
    params: { slug: entry.slug || entry.id.split('/').pop() },
    props: { entry },
  }))
}

const { entry } = Astro.props
const { Content } = await entry.render()

// 現在のコレクションが 'blog' かどうかを判定
const isBlog = entry.collection === 'blog'
---

<Layout frontmatter={entry.data}>
  {/* --- 1. Blog (投稿記事) のレイアウト --- */}
  {
    isBlog && (
      <article class="card shadow-sm border-0 mb-5 container">
        <header class="card-body p-4 p-md-5 border-bottom bg-light rounded-top">
          <div class="mb-3">
            <span class="badge bg-primary text-uppercase font-monospace">Blog Post</span>
          </div>
          <h1 class="display-5 fw-bold text-dark mb-3">{entry.data.title}</h1>
          <div class="text-muted small">
            <i class="bi bi-calendar3 me-1" />
            {entry.data.date ? entry.data.date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' }) : '日付なし'}
          </div>
        </header>

        <div class="card-body p-4 p-md-5 article-content">
          <Content />
        </div>

        <footer class="card-footer bg-white p-4 border-0 text-center">
          <hr class="mb-4" />
          <a href="/blog" class="btn btn-outline-secondary px-4">
            ← 記事一覧に戻る
          </a>
        </footer>
      </article>
    )
  }

  {/* --- 2. Page (固定ページ) のレイアウト --- */}
  {
    !isBlog && (
      <div>
        <div class="article-content">
          <Content />
        </div>
      </div>
    )
  }
</Layout>

<style is:global>
  /* 本文内のタイポグラフィを整える */
  .article-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #333;
  }

  .article-content h2 {
    font-weight: 700;
    margin-top: 2.5rem;
    margin-bottom: 1.25rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #eee;
  }

  .article-content p {
    margin-bottom: 1.5rem;
  }

  .article-content img {
    max-width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin: 2rem 0;
  }
</style>
